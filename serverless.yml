service: serverless-aws-node-sample

provider:
    name: aws
    runtime: nodejs10.x
    stage: ${self:custom.currentStage}
    logRetentionInDays: 30
    timeout: 30
    environment:
        DYNAMODB_TABLE: ${self:service}-${opt:stage, self:provider.stage}
    # iamRoleStatements:
    #   - Effect: "Allow"
    #     Action:
    #       - "apigateway:GET"
    #     Resource:
    #       - "arn:aws:apigateway:${self:provider.region}::/restapis*"
    #   - Effect: Allow
    #     Action:
    #       - dynamodb:Query
    #       - dynamodb:Scan
    #       - dynamodb:GetItem
    #       - dynamodb:PutItem
    #       - dynamodb:UpdateItem
    #       - dynamodb:DeleteItem
    #     Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"

plugins:
    - serverless-webpack
    - serverless-offline
    - serverless-aws-documentation
    # - serverless-domain-manager
    - serverless-stack-output

package:
    individually: true
    include: src/**/!.test.js
    exclude:
        - node_modules/**/*
        - src/**/*.test.js
        - src/**/*.ts

functions:
    - ${file(src/health/functions.yml)}
    - ${file(src/swagger/functions.yml)}
    - ${file(src/sample/functions.yml)}

# resources:
# API Gateway Errors
#   - ${file(resources/api-gateway-errors.yml)}
  # DynamoDB
#   - ${file(resources/dynamodb-table.yml)}
  # S3
#   - ${file(resources/s3-bucket.yml)}
  # Cognito
#   - ${file(resources/cognito-user-pool.yml)}

custom:
    documentation: ${file(swagger/documentation.yml)}
    defaultStage: dev
    currentStage: ${opt:stage, self:custom.defaultStage}
    # customDomain:
    #   basePath: "api"
    #   stage: ${self:provider.stage}
    #   domainName: serverless-aws-node-sample.dk
    #   certificateName: serverless-aws-node-sample.dk
    #   createRoute53Record: true
    # userPoolName: test-user-pool-${self:custom.currentStage}
    # userPoolClientName: test-user-pool-client-${self:custom.currentStage}
    environment: ${file(env.yml):${self:custom.stage}, file(env.yml):default}
    output:
        file: .serverless/output.json
    webpack:
        webpackConfig: "webpack.config.js"
        includeModules: false
        packager: "npm"
        excludeFiles: src/**/*.test.js
