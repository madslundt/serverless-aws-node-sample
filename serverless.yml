service: serverless-sample

provider:
    name: aws
    runtime: nodejs10.x
    stage: ${self:custom.currentStage}
    logRetentionInDays: 30
    timeout: 30
    environment:
      DYNAMODB_TABLE: ${self:service}-${opt:stage, self:provider.stage}
    # iamRoleStatements:
        # API Gateway
    #   - Effect: "Allow"
    #     Action:
    #       - "apigateway:GET"
    #     Resource:
    #       - "arn:aws:apigateway:${self:provider.region}::/restapis*"
    #   - Effect: Allow
    #     Action:
    #       - dynamodb:Query
    #       - dynamodb:Scan
    #       - dynamodb:GetItem
    #       - dynamodb:PutItem
    #       - dynamodb:UpdateItem
    #       - dynamodb:DeleteItem
    #     Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"

plugins:
    - serverless-webpack
    - serverless-offline
    - serverless-aws-documentation
    # - serverless-domain-manager
    - serverless-stack-output

package:
    individually: true
    include: src/**/!.test.js
    exclude:
        - node_modules/**/*
        - src/**/*.test.js
        - src/**/*.ts

functions:
    - ${file(./src/city/functions.yml)}
    - ${file(./src/swagger/functions.yml)}
    - ${file(./src/health/functions.yml)}
    - ${file(./src/sample/functions.yml)}

# resources:
#   Resources:
#     CognitoUserPool:
#       Type: "AWS::Cognito::UserPool"
#       Properties:
#         MfaConfiguration: OFF
#         UserPoolName: ${self:custom.userPoolName}
#         UsernameAttributes:
#           - email
#         Policies:
#           PasswordPolicy:
#             MinimumLength: 6
#             RequireLowercase: False
#             RequireNumbers: True
#             RequireSymbols: False
#             RequireUppercase: True
#     CognitoUserPoolClient:
#       Type: "AWS::Cognito::UserPoolClient"
#       Properties:
#         ClientName: ${self:custom.userPoolClientName}
#         GenerateSecret: False
#         UserPoolId:
#           Ref: CognitoUserPool
#     ApiGatewayAuthorizer:
#       DependsOn:
#         - ApiGatewayRestApi
#       Type: AWS::ApiGateway::Authorizer
#       Properties:
#         Name: cognito-authorizer
#         IdentitySource: method.request.header.Authorization
#         RestApiId:
#           Ref: ApiGatewayRestApi
#         Type: COGNITO_USER_POOLS
#         ProviderARNs:
#           - Fn::GetAtt: [CognitoUserPool, Arn]
#   Outputs:
#     CognitoUserPoolArn:
#       Value:
#         Fn::GetAtt:
#           - CognitoUserPool
#           - Arn
#       Export:
#         Name: CognitoUserPoolArn-${self:custom.currentStage}

custom:
    documentation: ${file(./swagger/documentation.yml)}
    defaultStage: dev
    currentStage: ${opt:stage, self:custom.defaultStage}
    # customDomain:
    #   basePath: "api"
    #   domainName: serverless-aws-node-sample.dk
    #   certificateName: serverless-aws-node-sample.dk
    #   stage: ${self:provider.stage}
    #   createRoute53Record: true
    # userPoolName: test-user-pool-${self:custom.currentStage}
    # userPoolClientName: test-user-pool-client-${self:custom.currentStage}
    output:
        file: .serverless/output.json
    webpack:
        webpackConfig: "webpack.config.js"
        includeModules: false
        packager: "npm"
        excludeFiles: src/**/*.test.js
